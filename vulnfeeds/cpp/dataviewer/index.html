<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CVE Conversion Data Viewer</title>
    <style>
        html,
        body {
            height: 100%;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin-top: 0;
            display: flex;
            flex-direction: column;
        }

        table {
            width: 100%;
        }

        section {
            display: flex;
            flex: 1;
        }

        article {
            flex: 1;
        }

        iframe {
            display: flex;
            height: 100%;
            width: 100%;
            flex: 1;
        }
    </style>
    <script type="text/javascript">
        function updateCve() {
            let CVEID = document.querySelector("input[name='CVEID']").value;
            let environment = document.querySelector("input[name='environment']:checked").value;

            document.querySelector("iframe[name='nvd_source']").src = "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=" + CVEID;
            document.querySelector('p[name="nvd_source"]').innerHTML = '<a href="' + document.querySelector('iframe[name="nvd_source"]').src + '" target="_blank" rel="noopener noreferrer">' + document.querySelector("input[name='CVEID']").value + '</a> in the NVD'
            switch (environment) {
                case "staging":
                    document.querySelector("iframe[name='conversion_input']").src = "https://osv-test-cve-osv-conversion.storage.googleapis.com/parts/nvd/" + CVEID + ".nvd.json";
                    document.querySelector("iframe[name='osv_input']").src = "https://osv-test-cve-osv-conversion.storage.googleapis.com/osv-output/" + CVEID + ".json";
                    document.querySelector("iframe[name='osv_output']").src = "https://api.test.osv.dev/v1/vulns/" + CVEID;
                    break;
                case "production":
                    document.querySelector("iframe[name='conversion_input']").src = "https://cve-osv-conversion.storage.googleapis.com/parts/nvd/" + CVEID + ".nvd.json";
                    document.querySelector("iframe[name='osv_input']").src = "https://cve-osv-conversion.storage.googleapis.com/osv-output/" + CVEID + ".json";
                    document.querySelector("iframe[name='osv_output']").src = "https://api.osv.dev/v1/vulns/" + CVEID;
                    break;
            }
            document.querySelector('p[name="conversion_input"]').innerHTML = '<a href="' + document.querySelector('iframe[name="conversion_input"]').src + '" target="_blank" rel="noopener noreferrer"> Input to <tt>combine-to-osv</tt></a>'
            document.querySelector('p[name="osv_input"]').innerHTML = '<a href="' + document.querySelector('iframe[name="osv_input"]').src + '" target="_blank" rel="noopener noreferrer">Input to OSV.dev importer</a>'
            document.querySelector('p[name="osv_output"]').innerHTML = '<a href="' + document.querySelector('iframe[name="osv_output"]').src + '" target="_blank" rel="noopener noreferrer">Record in OSV.dev</a>'
        }
    </script>
</head>

<body>
    <header>
        <h1>Andy's Handy Dandy CVE Conversion Inspector</h1>
        <table>
            <tr>
                <td>
                    <form name="cve_selector" onchange="updateCve()">
                        <p>
                            CVE ID: <input type="text" name="CVEID">
                        </p>
                        <p>
                            <input type="radio" name="environment" value="staging" checked> Staging
                        </p>
                        <p>
                            <input type="radio" name="environment" value="production"> Production
                        </p>
                    </form>
                </td>
                <td>
                    <b>Andy's hot tips for best results:</b>
                    <ul>
                        <li>Install <a
                                href="https://chrome.google.com/webstore/detail/gifgpciglhhpmeefjdmlpboipkibhbjg">&lt;/&gt;iFrame
                                Allow</a> (optionally configuring it to only operate on
                            <tt>https://andrewpollock.github.io/*</tt> and <tt>https://services.nvd.nist.gov/*</tt>)
                        </li>
                        <li>Install <a
                                href="https://chrome.google.com/webstore/detail/bcjindcccaagfpapjjmafapmmgkkhgoa">JSON
                                Formatter</a>
                            (maybe once <a href="https://github.com/callumlocke/json-formatter/pull/259">#259</a> is
                            merged it'll do the right thing in iframes as well)</li>
                    </ul>
                </td>
            </tr>
        </table>
    </header>
    <section>
        <article>
            <p name="nvd_source"></p>
            <iframe title="The NVD source record" name="nvd_source"></iframe>
        </article>
        <article>
            <p name="conversion_input"></p>
            <iframe title="The VersionInfo input to combine-to-osv" name="conversion_input"></iframe>
        </article>
        <article>
            <p name="osv_input"></p>
            <iframe title="The OSV record input to OSV.dev importer" name="osv_input"></iframe>
        </article>
        <article>
            <p name="osv_output"></p>
            <iframe title="The resultant OSV record in OSV.dev" name="osv_output"></iframe>
        </article>
    </section>
</body>

</html>